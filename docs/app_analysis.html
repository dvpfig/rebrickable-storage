<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rebrickable Storage - Application Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #ddd;
            padding: 0 30px;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 40px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        .function-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .function-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .function-name {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .function-module {
            color: #666;
            font-size: 0.85em;
        }
        
        .function-params {
            color: #888;
            font-size: 0.85em;
            font-family: monospace;
        }
        
        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        
        .timestamp {
            color: #999;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§± Rebrickable Storage</h1>
            <p>Application Architecture Analysis</p>
        </header>
        
        <div class="stats">
            <div class="stat-card">
                <span class="stat-number">47</span>
                <span class="stat-label">Functions</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">3</span>
                <span class="stat-label">Classes</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">11</span>
                <span class="stat-label">Session Keys</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">12</span>
                <span class="stat-label">Modules</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">1815</span>
                <span class="stat-label">Cached Images</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">4014</span>
                <span class="stat-label">Cached Labels</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">13.61 MB</span>
                <span class="stat-label">Images Cache</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">67.71 MB</span>
                <span class="stat-label">Labels Cache</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Overview</button>
            <button class="tab" onclick="showTab('architecture')">Architecture</button>
            <button class="tab" onclick="showTab('metrics')">Metrics</button>
            <button class="tab" onclick="showTab('functions')">Functions</button>
            <button class="tab" onclick="showTab('flow')">Flow Diagram</button>
        </div>
        
        <div id="overview" class="tab-content active">
            <h2>Application Overview</h2>
            <p>This report provides a comprehensive analysis of the Rebrickable Storage application architecture, 
            including execution flow, user experience journey, data structures, and module dependencies.</p>
            
            <h3 style="margin-top: 30px;">Key Components</h3>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Core Modules:</strong> Authentication, path management, data preprocessing, image handling, color mapping, label generation</li>
                <li><strong>UI Modules:</strong> Theme management, layout helpers, summary tables</li>
                <li><strong>Data Flow:</strong> CSV upload â†’ validation â†’ merging â†’ enrichment â†’ display â†’ export</li>
                <li><strong>Storage:</strong> User-specific data directories, shared image cache, session persistence</li>
            </ul>
            
            <h3 style="margin-top: 30px;">Session State Keys</h3>
            <div class="function-list">
                <div class="function-card"><div class="function-name">collection_df</div></div><div class="function-card"><div class="function-name">expanded_loc</div></div><div class="function-card"><div class="function-name">found_counts</div></div><div class="function-card"><div class="function-name">labels_zip_bytes</div></div><div class="function-card"><div class="function-name">labels_zip_filename</div></div><div class="function-card"><div class="function-name">locations_index</div></div><div class="function-card"><div class="function-name">merged_df</div></div><div class="function-card"><div class="function-name">merged_source_hash</div></div><div class="function-card"><div class="function-name">part_images_map</div></div><div class="function-card"><div class="function-name">start_processing</div></div><div class="function-card"><div class="function-name">theme</div></div>
            </div>
        </div>
        
        <div id="architecture" class="tab-content">
            <h2>Architecture Overview</h2>
            
            <h3>Technology Stack</h3>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Frontend:</strong> Streamlit (Web UI Framework)</li>
                <li><strong>Authentication:</strong> streamlit-authenticator, bcrypt, PyYAML</li>
                <li><strong>Data Processing:</strong> pandas, requests</li>
                <li><strong>Storage:</strong> Local filesystem (Development), JSON (Session serialization)</li>
            </ul>
            
            <h3 style="margin-top: 30px;">Session State Management</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h4>Global (Shared)</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>ba_mapping - Part number mappings</li>
                        <li>color_lookup - Color database</li>
                        <li>theme - UI theme preference</li>
                    </ul>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h4>User-Specific (Isolated)</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>username - Current user</li>
                        <li>authenticated - Auth status</li>
                        <li>collection_df - User's collection</li>
                        <li>found_counts - Parts marked as found</li>
                        <li>locations_index - Location grouping</li>
                        <li>merged_df - Matched parts</li>
                    </ul>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">External Integrations</h3>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Rebrickable API:</strong> Part data and mappings</li>
                <li><strong>BrickArchitect Images:</strong> Part images (cached locally)</li>
            </ul>
            
            <h3 style="margin-top: 30px;">Deployment</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
                    <h4>Development</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>localhost:8501</li>
                        <li>File-based storage</li>
                        <li>Local user_data/</li>
                        <li>YAML configuration</li>
                    </ul>
                </div>
                <div style="background: #e8f5e9; padding: 20px; border-radius: 8px;">
                    <h4>Production (Recommended)</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>HTTPS with SSL/TLS</li>
                        <li>Database backend (PostgreSQL/MongoDB)</li>
                        <li>Cloud storage (S3/Azure Blob)</li>
                        <li>Environment secrets management</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="metrics" class="tab-content">
            <h2>Runtime Metrics & Data Dimensions</h2>
            
            <h3>Cache Statistics</h3>
            <div class="function-list">
                <div class="function-card">
                    <div class="function-name">Cached Images</div>
                    <div class="function-module">1815 files</div>
                </div>
                <div class="function-card">
                    <div class="function-name">Images Cache Size</div>
                    <div class="function-module">13.61 MB</div>
                </div>
                <div class="function-card">
                    <div class="function-name">Cached Labels</div>
                    <div class="function-module">4014 files</div>
                </div>
                <div class="function-card">
                    <div class="function-name">Labels Cache Size</div>
                    <div class="function-module">67.71 MB</div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Resource Data</h3>
            <div class="function-list">
                <div class="function-card">
                    <div class="function-name">Colors Database</div>
                    <div class="function-module">N/A rows Ã— N/A columns</div>
                </div>
                <div class="function-card">
                    <div class="function-name">Part Mappings (BA â†” RB)</div>
                    <div class="function-module">N/A rows Ã— N/A columns</div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">User Data</h3>
            <div class="function-list">
                <div class="function-card">
                    <div class="function-name">Total Users</div>
                    <div class="function-module">1 users</div>
                </div>
                <div class="function-card">
                    <div class="function-name">User Collection Files</div>
                    <div class="function-module">0 files</div>
                </div>
                <div class="function-card">
                    <div class="function-name">Default Collection Files</div>
                    <div class="function-module">14 files</div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Data Structure Dimensions</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                <h4>DataFrame Schemas</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>wanted_df:</strong> ~4-5 columns (Part, Color, Quantity, Location)</li>
                    <li><strong>collection_df:</strong> ~4 columns (Part, Color, Quantity, Location)</li>
                    <li><strong>merged_df:</strong> ~8-10 columns (includes Image URL, Color data)</li>
                </ul>
                
                <h4 style="margin-top: 20px;">Dictionary Structures</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>found_counts:</strong> {(part, color, location): count}</li>
                    <li><strong>locations_index:</strong> {location: [image_urls]}</li>
                    <li><strong>ba_mapping:</strong> {ba_part_number: rb_part_number}</li>
                    <li><strong>color_lookup:</strong> {color_id: {name, rgb, ...}}</li>
                </ul>
            </div>
        </div>
        
        <div id="functions" class="tab-content">
            <h2>Function Reference</h2>
            <p>All functions discovered in the application (47 total)</p>
            
            <div class="function-list">
                
                <div class="function-card">
                    <div class="function-name">_df_bytes</div>
                    <div class="function-module">ğŸ“ app.py</div>
                    <div class="function-params">(df)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">__init__</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self, config_path)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">_create_default_config</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">load_user_session</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self, username, user_data_dir)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">logout</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">register_user</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">reset_password</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">save_user_session</div>
                    <div class="function-module">ğŸ“ core\auth.py</div>
                    <div class="function-params">(self, username, session_data, user_data_dir)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">build_color_lookup</div>
                    <div class="function-module">ğŸ“ core\colors.py</div>
                    <div class="function-params">(colors_df)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">load_colors</div>
                    <div class="function-module">ğŸ“ core\colors.py</div>
                    <div class="function-params">(colors_path)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">render_color_cell</div>
                    <div class="function-module">ğŸ“ core\colors.py</div>
                    <div class="function-params">(color_id, color_lookup)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">_fetch_single_image</div>
                    <div class="function-module">ğŸ“ core\images.py</div>
                    <div class="function-params">(identifier, cache_dir, session)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">fetch_image_bytes</div>
                    <div class="function-module">ğŸ“ core\images.py</div>
                    <div class="function-params">(url, _session)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">get_cached_images_batch</div>
                    <div class="function-module">ğŸ“ core\images.py</div>
                    <div class="function-params">(part_ids, cache_dir, max_workers)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">precompute_location_images</div>
                    <div class="function-module">ğŸ“ core\images.py</div>
                    <div class="function-params">(collection_df_serialized, ba_mapping, cache_images_dir)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">generate_collection_labels_zip</div>
                    <div class="function-module">ğŸ“ core\labels.py</div>
                    <div class="function-params">(collection_files_stream, ba_mapping, labels_source_dir, output_mode)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">organize_labels_by_location</div>
                    <div class="function-module">ğŸ“ core\labels.py</div>
                    <div class="function-params">(collection_df, ba_mapping, labels_source_dir, output_mode)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">ensure_session_state_keys</div>
                    <div class="function-module">ğŸ“ ui\layout.py</div>
                    <div class="function-params">()</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">short_key</div>
                    <div class="function-module">ğŸ“ ui\layout.py</div>
                    <div class="function-params">()</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">__init__</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, max_length_mm, spacing_mm)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">calculate_label_bounds</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, objects, resize_text)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">create_merged_label_xml</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, label_contents)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">extract_label_content_zip</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, filepath)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">get_label_content_width_mm</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, label_xml)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">get_label_content_width_pt</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, label_xml)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">get_label_objects</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, root)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">get_paper_element</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, root)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">get_text_visual_width</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, text_elem)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">main</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">()</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">merge_labels</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, input_files, output_file)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">merge_properties_xml</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, label_contents)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">merge_zip_based_labels</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, label_contents, output_path)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">parse_label_xml</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, xml)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">shift_object_positions</div>
                    <div class="function-module">ğŸ“ core\lbx_merger.py</div>
                    <div class="function-params">(self, obj, x_offset, y_offset)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">load_ba_mapping</div>
                    <div class="function-module">ğŸ“ core\mapping.py</div>
                    <div class="function-params">(mapping_path)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">read_ba_mapping_from_excel_bytes</div>
                    <div class="function-module">ğŸ“ core\mapping.py</div>
                    <div class="function-params">(excel_bytes)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">__init__</div>
                    <div class="function-module">ğŸ“ core\paths.py</div>
                    <div class="function-params">(self)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">init_paths</div>
                    <div class="function-module">ğŸ“ core\paths.py</div>
                    <div class="function-params">()</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">manage_default_collection</div>
                    <div class="function-module">ğŸ“ core\paths.py</div>
                    <div class="function-params">(user_collection_dir)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">save_uploadedfiles</div>
                    <div class="function-module">ğŸ“ core\paths.py</div>
                    <div class="function-params">(uploadedfiles_list, user_collection_dir)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">load_collection_files</div>
                    <div class="function-module">ğŸ“ core\preprocess.py</div>
                    <div class="function-params">(files)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">load_wanted_files</div>
                    <div class="function-module">ğŸ“ core\preprocess.py</div>
                    <div class="function-params">(files)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">merge_wanted_collection</div>
                    <div class="function-module">ğŸ“ core\preprocess.py</div>
                    <div class="function-params">(wanted, collection)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">sanitize_and_validate</div>
                    <div class="function-module">ğŸ“ core\preprocess.py</div>
                    <div class="function-params">(df, required, label)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">render_summary_table</div>
                    <div class="function-module">ğŸ“ ui\summary.py</div>
                    <div class="function-params">(merged_df)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">apply_dark_theme</div>
                    <div class="function-module">ğŸ“ ui\theme.py</div>
                    <div class="function-params">()</div>
                </div>
                
                <div class="function-card">
                    <div class="function-name">apply_light_theme</div>
                    <div class="function-module">ğŸ“ ui\theme.py</div>
                    <div class="function-params">()</div>
                </div>
                
            </div>
        </div>
        
        <div id="flow" class="tab-content">
            <h2>Application Flow Diagram</h2>
            <pre>================================================================================
APPLICATION EXECUTION FLOW
================================================================================

â”Œâ”€ app.py (Main Entry Point)
â”‚
â”œâ”€â”¬â”€ CORE MODULES
â”‚ â”œâ”€ core/auth.py
â”‚     â””â”€ __init__(self, config_path)
â”‚     â””â”€ _create_default_config(self)
â”‚     â””â”€ register_user(self)
â”‚ â”œâ”€ core/paths.py
â”‚     â””â”€ init_paths()
â”‚     â””â”€ save_uploadedfiles(uploadedfiles_list, user_collection_dir)
â”‚     â””â”€ manage_default_collection(user_collection_dir)
â”‚ â”œâ”€ core/mapping.py
â”‚     â””â”€ read_ba_mapping_from_excel_bytes(excel_bytes)
â”‚     â””â”€ load_ba_mapping(mapping_path)
â”‚ â”œâ”€ core/preprocess.py
â”‚     â””â”€ sanitize_and_validate(df, required, label)
â”‚     â””â”€ load_wanted_files(files)
â”‚     â””â”€ load_collection_files(files)
â”‚ â”œâ”€ core/images.py
â”‚     â””â”€ precompute_location_images(collection_df_serialized, ba_mapping, cache_images_dir)
â”‚     â””â”€ fetch_image_bytes(url, _session)
â”‚     â””â”€ _fetch_single_image(identifier, cache_dir, session)
â”‚ â”œâ”€ core/colors.py
â”‚     â””â”€ load_colors(colors_path)
â”‚     â””â”€ build_color_lookup(colors_df)
â”‚     â””â”€ render_color_cell(color_id, color_lookup)
â”‚ â”œâ”€ core/labels.py
â”‚     â””â”€ organize_labels_by_location(collection_df, ba_mapping, labels_source_dir, ...)
â”‚     â””â”€ generate_collection_labels_zip(collection_files_stream, ba_mapping, labels_source_dir, ...)
â”‚ â””â”€ core/lbx_merger.py
      â””â”€ main()
      â””â”€ __init__(self, max_length_mm, spacing_mm)
      â””â”€ parse_label_xml(self, xml)
â”‚
â”œâ”€â”¬â”€ UI MODULES
â”‚ â”œâ”€ ui/theme.py
â”‚ â”œâ”€ ui/layout.py
â”‚ â””â”€ ui/summary.py
â”‚
â””â”€â”¬â”€ RESOURCES
  â”œâ”€ auth_config.yaml (User credentials)
  â”œâ”€ colors.csv (LEGO color database)
  â””â”€ part number mapping.xlsx (BA â†” RB)

================================================================================
USER EXPERIENCE FLOW
================================================================================

â”Œâ”€ 1. LOGIN
â”‚  â”œâ”€ User enters credentials
â”‚  â”œâ”€ AuthManager.login() validates
â”‚  â”œâ”€ Session initialized
â”‚  â””â”€ Redirect to main app
â”‚
â–¼
â”‚
â”Œâ”€ 2. UPLOAD WANTED PARTS
â”‚  â”œâ”€ File uploader widget
â”‚  â”œâ”€ CSV validation
â”‚  â”œâ”€ Store in session_state['wanted_df']
â”‚  â””â”€ Display preview
â”‚
â–¼
â”‚
â”Œâ”€ 3. SELECT COLLECTION
â”‚  â”œâ”€ List available collection files
â”‚  â”œâ”€ User selects files
â”‚  â”œâ”€ Load CSVs into session_state['collection_df']
â”‚  â””â”€ Merge collections
â”‚
â–¼
â”‚
â”Œâ”€ 4. PROCESS & MATCH
â”‚  â”œâ”€ preprocess.merge_wanted_collection()
â”‚  â”œâ”€ mapping.apply_part_mappings()
â”‚  â”œâ”€ images.fetch_images()
â”‚  â”œâ”€ colors.add_color_data()
â”‚  â””â”€ Group by location
â”‚
â–¼
â”‚
â”Œâ”€ 5. BROWSE LOCATIONS
â”‚  â”œâ”€ Display location cards
â”‚  â”œâ”€ Show part images
â”‚  â”œâ”€ Display quantities needed/available
â”‚  â””â”€ Expandable details
â”‚
â–¼
â”‚
â”Œâ”€ 6. MARK FOUND PARTS
â”‚  â”œâ”€ User clicks 'Found' button
â”‚  â”œâ”€ Update session_state['found_counts']
â”‚  â”œâ”€ Recalculate remaining
â”‚  â””â”€ Visual feedback
â”‚
â–¼
â”‚
â”Œâ”€ 7. EXPORT RESULTS
â”‚  â”œâ”€ Download merged CSV
â”‚  â”œâ”€ Generate location labels
â”‚  â”œâ”€ Create LBX file
â”‚  â””â”€ Save session progress
â”‚

================================================================================
DATA STRUCTURES & DIMENSIONS
================================================================================

â”Œâ”€ SESSION STATE (st.session_state)
â”‚
â”‚  â”œâ”€ wanted_df: DataFrame
â”‚  â”‚     â””â”€ Wanted parts list
â”‚  â”‚        â””â”€ Columns: Part, Color, Quantity, Location
â”‚  â”œâ”€ collection_df: DataFrame
â”‚  â”‚     â””â”€ User's collection
â”‚  â”‚        â””â”€ Columns: Part, Color, Quantity, Location
â”‚  â”œâ”€ merged_df: DataFrame
â”‚  â”‚     â””â”€ Matched parts
â”‚  â”‚        â””â”€ wanted_df + collection_df merged
â”‚  â”œâ”€ found_counts: Dict
â”‚  â”‚     â””â”€ Tracking found parts
â”‚  â”‚        â””â”€ {(part, color, location): count}
â”‚  â”œâ”€ locations_index: Dict
â”‚  â”‚     â””â”€ Location grouping
â”‚  â”‚        â””â”€ {location: [image_urls]}
â”‚  â”œâ”€ expanded_loc: str
â”‚  â”‚     â””â”€ UI state
â”‚  â”‚        â””â”€ Currently expanded location
â”‚  â”œâ”€ start_processing: bool
â”‚  â”‚     â””â”€ Trigger flag
â”‚  â”‚        â””â”€ Initiates processing
â”‚  â””â”€ theme: str
â”‚        â””â”€ UI preference
â”‚           â””â”€ 'dark' or 'light'
â”‚
â”œâ”€ DATAFRAMES
â”‚
â”‚  â”œâ”€ wanted_df
â”‚  â”‚     â”œâ”€ Part Number (str)
â”‚  â”‚     â”œâ”€ Color (str)
â”‚  â”‚     â”œâ”€ Quantity Needed (int)
â”‚  â”‚     â””â”€ Location (str, optional)
â”‚  â”œâ”€ collection_df
â”‚  â”‚     â”œâ”€ Part Number (str)
â”‚  â”‚     â”œâ”€ Color (str)
â”‚  â”‚     â”œâ”€ Quantity Available (int)
â”‚  â”‚     â””â”€ Location (str)
â”‚  â””â”€ merged_df
â”‚        â”œâ”€ Part Number (str)
â”‚        â”œâ”€ Color (str)
â”‚        â”œâ”€ Quantity Needed (int)
â”‚        â”œâ”€ Quantity Available (int)
â”‚        â”œâ”€ Location (str)
â”‚        â”œâ”€ Image URL (str)
â”‚        â”œâ”€ Color Name (str)
â”‚        â””â”€ Color RGB (str)
â”‚
â””â”€ FILE SYSTEM

   â”œâ”€ user_data/{username}/
   â”‚     â”œâ”€ collection/*.csv - User's collection files
   â”‚     â””â”€ session_data.json - Saved progress
   â”œâ”€ cache/
   â”‚     â”œâ”€ images/*.png - Cached part images
   â”‚     â””â”€ labels/*.png - Generated label images
   â””â”€ resources/
         â”œâ”€ auth_config.yaml - User credentials (hashed)
         â”œâ”€ colors.csv - LEGO color database (~200 colors)
         â””â”€ part number mapping.xlsx - BAâ†”RB mappings (~2000 parts)

================================================================================
MODULE DEPENDENCIES
================================================================================

app.py
â”‚
â”œâ”€ core.auth
â”‚    â””â”€ â†’ core.paths
â”œâ”€ core.preprocess
â”‚    â”œâ”€ â†’ core.mapping
â”‚    â””â”€ â†’ core.paths
â”œâ”€ core.images
â”‚    â””â”€ â†’ core.paths
â”œâ”€ core.labels
â”‚    â”œâ”€ â†’ core.paths
â”‚    â””â”€ â†’ core.images
â”œâ”€ core.lbx_merger
â”‚    â””â”€ â†’ core.paths
â”œâ”€ ui.layout
â”œâ”€ ui.summary
â”‚    â””â”€ â†’ core.colors
â””â”€ ui.theme

================================================================================
ARCHITECTURE OVERVIEW
================================================================================

â”Œâ”€ TECHNOLOGY STACK
â”‚
â”‚  Frontend
â”‚  â””â”€ Streamlit (Web UI Framework)
â”‚
â”‚  Authentication
â”‚  â”œâ”€ streamlit-authenticator (Auth library)
â”‚  â”œâ”€ bcrypt (Password hashing)
â”‚  â””â”€ PyYAML (Config management)
â”‚
â”‚  Data Processing
â”‚  â”œâ”€ pandas (Data manipulation)
â”‚  â””â”€ requests (HTTP client)
â”‚
â”‚  Storage
â”‚  â”œâ”€ Local filesystem (Development)
â”‚  â””â”€ JSON (Session serialization)
â”‚
â”œâ”€ SESSION STATE MANAGEMENT
â”‚
â”‚  Global (Shared)
â”‚  â”œâ”€ ba_mapping - Part number mappings
â”‚  â”œâ”€ color_lookup - Color database
â”‚  â””â”€ theme - UI theme preference
â”‚
â”‚  User-Specific (Isolated)
â”‚  â”œâ”€ username - Current user
â”‚  â”œâ”€ authenticated - Auth status
â”‚  â”œâ”€ collection_df - User's collection
â”‚  â”œâ”€ found_counts - Parts marked as found
â”‚  â”œâ”€ locations_index - Location grouping
â”‚  â””â”€ merged_df - Matched parts
â”‚
â”œâ”€ EXTERNAL INTEGRATIONS
â”‚
â”‚  â”Œâ”€ Rebrickable API
â”‚  â”‚  â””â”€ Part data and mappings
â”‚  â”‚
â”‚  â””â”€ BrickArchitect Images
â”‚     â””â”€ Part images (cached locally)
â”‚
â””â”€ DEPLOYMENT

   Development:
   â”œâ”€ localhost:8501
   â”œâ”€ File-based storage
   â”œâ”€ Local user_data/
   â””â”€ YAML configuration

   Production (Recommended):
   â”œâ”€ HTTPS with SSL/TLS
   â”œâ”€ Database backend (PostgreSQL/MongoDB)
   â”œâ”€ Cloud storage (S3/Azure Blob)
   â””â”€ Environment secrets management

================================================================================
RUNTIME METRICS & DATA DIMENSIONS
================================================================================

â”Œâ”€ CACHE STATISTICS
â”‚
â”‚  Cached Images: 1815 files
â”‚  Images Size: 13.61 MB
â”‚  Cached Labels: 4014 files
â”‚  Labels Size: 67.71 MB
â”‚
â”œâ”€ RESOURCE DATA
â”‚
â”‚  Colors Database:
â”‚  â”œâ”€ Rows: N/A
â”‚  â””â”€ Columns: N/A
â”‚
â”‚  Part Mappings (BA â†” RB):
â”‚  â”œâ”€ Rows: N/A
â”‚  â””â”€ Columns: N/A
â”‚
â”œâ”€ USER DATA
â”‚
â”‚  Total Users: 1
â”‚  User Collection Files: 0
â”‚  Default Collection Files: 14
â”‚
â””â”€ DATA STRUCTURE DIMENSIONS

   DataFrame Schemas:
   â”œâ”€ wanted_df: ~4-5 columns (Part, Color, Quantity, Location)
   â”œâ”€ collection_df: ~4 columns (Part, Color, Quantity, Location)
   â””â”€ merged_df: ~8-10 columns (includes Image URL, Color data)

   Dictionary Structures:
   â”œâ”€ found_counts: {(part, color, location): count}
   â”œâ”€ locations_index: {location: [image_urls]}
   â”œâ”€ ba_mapping: {ba_part_number: rb_part_number}
   â””â”€ color_lookup: {color_id: {name, rgb, ...}}

================================================================================
STATISTICS SUMMARY
================================================================================
Total Functions: 47
Total Classes: 3
Session State Keys: 11
Modules Analyzed: 12
Cached Images: 1815 (13.61 MB)
Cached Labels: 4014 (67.71 MB)</pre>
        </div>
        
        <footer>
            <p class="timestamp">Generated on 2026-02-06 22:47:40</p>
            <p>Run <code>python docs/analyze_app.py</code> to update this report</p>
        </footer>
    </div>
    
    <script>
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
